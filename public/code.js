"use strict";const e=["id","parent","name","removed","visible","locked","children","constraints","absoluteTransform","relativeTransform","x","y","rotation","width","height","constrainProportions","layoutAlign","layoutGrow","opacity","blendMode","isMask","effects","effectStyleId","expanded","backgrounds","backgroundStyleId","fills","strokes","strokeWeight","strokeMiterLimit","strokeAlign","strokeCap","strokeJoin","dashPattern","fillStyleId","strokeStyleId","cornerRadius","cornerSmoothing","topLeftRadius","topRightRadius","bottomLeftRadius","bottomRightRadius","exportSettings","overflowDirection","numberOfFixedChildren","overlayPositionType","overlayBackground","overlayBackgroundInteraction","reactions","description","remote","key","layoutMode","primaryAxisSizingMode","counterAxisSizingMode","primaryAxisAlignItems","counterAxisAlignItems","paddingLeft","paddingRight","paddingTop","paddingBottom","itemSpacing","layoutGrids","gridStyleId","clipsContent","guides"],t=["id","parent","removed","children","absoluteTransform","width","height","overlayPositionType","overlayBackground","overlayBackgroundInteraction","reactions","remote","key","type"],i=["rotation","constrainProportions"],n=["name","guides","description","remote","key","reactions","x","y","exportSettings","expanded","isMask","exportSettings","overflowDirection","numberOfFixedChildren","constraints","relativeTransform"];function o(e){return JSON.parse(JSON.stringify(e))}const a=["opacity","blendMode","effects","effectStyleId","backgrounds","backgroundStyleId","fills","strokes","strokeWeight","strokeMiterLimit","strokeAlign","strokeCap","strokeJoin","dashPattern","fillStyleId","strokeStyleId","cornerRadius","cornerSmoothing","topLeftRadius","topRightRadius","bottomLeftRadius","bottomRightRadius","paddingLeft","paddingRight","paddingTop","paddingBottom","itemSpacing","layoutGrids","gridStyleId"];function r(r,l){return function a(r,l,{include:s,exclude:d}={}){let g=e.filter((function(e){return!n.concat(t).includes(e)}));s&&(g=g.concat(s)),d&&(g=g.filter((function(e){return!d.includes(e)}))),"INSTANCE"===(null==l?void 0:l.parent.type)&&(g=g.filter((function(e){return!i.includes(e)})));const c=r,f=typeof r;if("undefined"===f||"number"===f||"string"===f||"boolean"===f||"symbol"===f||null===r)return c;if("object"===f){if(c instanceof Array){var u=[];for(const e in r)u.push(o(r[e]));return u}if(c instanceof Uint8Array)return new Uint8Array(c);{const e={};for(const t in c)if(l)for(const i in l)g.includes(i)&&t===i&&(e[t]=a(c[t],l));else e[t]=a(c[t]);return l?((e.fillStyleId||!e.fills)&&delete e.fills,(e.strokeStyleId||!e.strokes)&&delete e.strokes,(e.backgroundStyleId||!e.backgrounds)&&delete e.backgrounds,e.cornerRadius!==figma.mixed?(delete e.topLeftRadius,delete e.topRightRadius,delete e.bottomLeftRadius,delete e.bottomRightRadius):delete e.cornerRadius,Object.assign(l,e)):e}}throw"unknown"}(r,l,{include:a,exclude:["autoRename","characters","fontName","fontSize","rotation","primaryAxisSizingMode","counterAxisSizingMode","primaryAxisAlignItems","counterAxisAlignItems","constrainProportions","layoutAlign","layoutGrow","layoutMode"]})}function l(e){var t=d();for(let n=0;n<t.length;n++){if((i=t[n]).id===e.id)return console.log("Layer style already exists"),void figma.notify("Layer style already exists")}var i={id:e.id,node:r(e),name:e.name};t.push(i),figma.root.setPluginData("styles",JSON.stringify(t))}function s(e,t,i,n){var o=d();o.map(o=>{o.id==e&&(t&&(o.name=t),i&&(o.node=i),n&&(o.id=n))}),figma.root.setPluginData("styles",JSON.stringify(o))}function d(e){var t=figma.root.getPluginData("styles");if(t=""!==t?JSON.parse(t):[],e){var i=t.filter((function(t){return t.id===e}));t=i[0]}return t}function g(e,t){var i;if(e&&(i=e),t){i=[];var n=figma.root.children,o=n.length;for(let e=0;e<o;e++)n[e].findAll(e=>{e.getPluginData("styleId")===t&&i.push(e)})}for(let e=0;e<i.length;e++){var a,l=i[e],g=l.getPluginData("styleId"),c=figma.getNodeById(g);if(c)s(g,null,r(a=c)),r(a,l);else r(a=d(g).node,l),console.log("Original node can't be found")}}function c(e){if(e.length>0){(n=e.map(e=>e)).sort((e,t)=>e.x-t.x),e=n.sort((e,t)=>e.y-t.y);for(var t=0;t<e.length;t++){var i=e[t];i.setPluginData("styleId",i.id),l(i)}}else figma.notify("No nodes selected");var n}function f(e){e.setPluginData("styleId",""),e.setRelaunchData({})}function u(){var e=d();figma.ui.postMessage(e)}var m;if(figma.on("selectionchange",()=>{console.log("Selection changed");var e=figma.currentPage.selection[0];e?""!==e.getPluginData("styleId")&&(console.log("Selection has a layer style"),e.id===e.getPluginData("styleId")&&(console.log("Selection is master"),m=e)):m=null}),setInterval(()=>{!function(e){e&&(s(e.getPluginData("styleId"),null,r(e)),u())}(m)},600),"showStyles"===figma.command&&(figma.showUI(__html__,{width:240,height:360}),u(),figma.ui.onmessage=e=>{if("add-style"===e.type&&(c(figma.currentPage.selection),u()),"rename-style"===e.type&&(s(e.id,e.name),u()),"update-instances"===e.type&&(g(figma.currentPage.selection,e.id),u()),"update-style"===e.type){var t=r(i=figma.currentPage.selection[0]);s(e.id,null,t,i.id),figma.currentPage.selection[0].setPluginData("styleId",i.id),u()}if("edit-layer-style"===e.type){var i;if(function(e){return!e||(null===e.parent||null===e.parent.parent)}(i=figma.getNodeById(e.id))){var n=(i=figma.createFrame()).id;r((t=d(e.id)).node,i),function(e){e.x=figma.viewport.center.x-e.width/2,e.y=figma.viewport.center.y-e.height/2}(i),i.name=`${t.name}`,figma.viewport.scrollAndZoomIntoView([i]),figma.viewport.zoom=.25,i.setPluginData("styleId",i.id),s(e.id,null,null,i.id);var o=(a=e.id,figma.root.findAll(e=>e.getPluginData("styleId")===a));console.log(o),o.map(e=>{e.setPluginData("styleId",n)}),figma.currentPage.selection=[i]}else figma.viewport.scrollAndZoomIntoView([i]),figma.viewport.zoom=.25,figma.currentPage=function e(t){return"PAGE"===t.parent.type?t.parent:e(t.parent)}(i),figma.currentPage.selection=[i];u()}var a;"apply-style"===e.type&&function(e,t){if(0===e.length)figma.notify("Please select one or more layers");else{for(let o=0;o<e.length;o++){var i=e[o];i.setPluginData("styleId",t),i.setRelaunchData({detachLayerStyle:"Removes association with layer style"});var n=figma.getNodeById(t);if(n)r(n,i);else r(d(t).node,i),console.log("Original node can't be found")}figma.notify("Layer style applied")}}(figma.currentPage.selection,e.id),"remove-style"===e.type&&(!function(e){var t=d();t.splice(t.findIndex(t=>t.id===e),1),figma.root.setPluginData("styles",JSON.stringify(t)),figma.root.findAll(t=>{t.getPluginData("styleId")===e&&t.setPluginData("styleId","")})}(e.id),u())}),"createStyles"===figma.command&&(c(figma.currentPage.selection),figma.closePlugin()),"updateStyles"===figma.command&&(g(figma.currentPage.selection),figma.closePlugin()),"clearStyles"===figma.command&&(figma.root.setPluginData("styles",""),console.log("Styles cleared"),figma.closePlugin()),"copyProperties"===figma.command&&r(figma.currentPage.selection[0]),"detachLayerStyle"===figma.command){for(var y=0;y<figma.currentPage.selection.length;y++){f(figma.currentPage.selection[y])}figma.notify("Layer style detached"),figma.closePlugin()}
