"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function e(e,t,i,n){return new(i||(i=Promise))((function(o,a){function r(e){try{s(n.next(e))}catch(e){a(e)}}function l(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,l)}s((n=n.apply(e,t||[])).next())}))}const t=["id","parent","name","removed","visible","locked","children","constraints","absoluteTransform","relativeTransform","x","y","rotation","width","height","constrainProportions","layoutAlign","layoutGrow","opacity","blendMode","isMask","effects","effectStyleId","expanded","backgrounds","backgroundStyleId","fills","strokes","strokeWeight","strokeMiterLimit","strokeAlign","strokeCap","strokeJoin","dashPattern","fillStyleId","strokeStyleId","cornerRadius","cornerSmoothing","topLeftRadius","topRightRadius","bottomLeftRadius","bottomRightRadius","exportSettings","overflowDirection","numberOfFixedChildren","overlayPositionType","overlayBackground","overlayBackgroundInteraction","reactions","description","remote","key","layoutMode","primaryAxisSizingMode","counterAxisSizingMode","primaryAxisAlignItems","counterAxisAlignItems","paddingLeft","paddingRight","paddingTop","paddingBottom","itemSpacing","layoutGrids","gridStyleId","clipsContent","guides"],i=["id","parent","removed","children","absoluteTransform","width","height","overlayPositionType","overlayBackground","overlayBackgroundInteraction","reactions","remote","key","type"],n=["rotation","constrainProportions"],o=["name","guides","description","remote","key","reactions","x","y","exportSettings","expanded","isMask","exportSettings","overflowDirection","numberOfFixedChildren","constraints","relativeTransform"];function a(e){return JSON.parse(JSON.stringify(e))}function r(e,l,{include:s,exclude:d}={}){let g=t.filter((function(e){return!o.concat(i).includes(e)}));s&&(g=g.concat(s)),d&&(g=g.filter((function(e){return!d.includes(e)}))),"INSTANCE"===(null==l?void 0:l.parent.type)&&(g=g.filter((function(e){return!n.includes(e)})));const c=e,f=typeof e;if("undefined"===f||"number"===f||"string"===f||"boolean"===f||"symbol"===f||null===e)return c;if("object"===f){if(c instanceof Array){var u=[];for(const t in e)u.push(a(e[t]));return u}if(c instanceof Uint8Array)return new Uint8Array(c);{const e={};for(const t in c)if(g.includes(t)&&"horizontalPadding"!==t&&"verticalPadding"!==t)if(l)for(const i in l)g.includes(i)&&t===i&&(e[t]=r(c[t],l));else e[t]=r(c[t]);return l?((e.fillStyleId||!e.fills)&&delete e.fills,(e.strokeStyleId||!e.strokes)&&delete e.strokes,(e.backgroundStyleId||!e.backgrounds)&&delete e.backgrounds,e.cornerRadius!==figma.mixed?(delete e.topLeftRadius,delete e.topRightRadius,delete e.bottomLeftRadius,delete e.bottomRightRadius):delete e.cornerRadius,Object.assign(l,e)):e}}throw"unknown"}const l=["opacity","blendMode","effects","effectStyleId","backgrounds","backgroundStyleId","fills","strokes","strokeWeight","strokeMiterLimit","strokeAlign","strokeCap","strokeJoin","dashPattern","fillStyleId","strokeStyleId","cornerRadius","cornerSmoothing","topLeftRadius","topRightRadius","bottomLeftRadius","bottomRightRadius","paddingLeft","paddingRight","paddingTop","paddingBottom","itemSpacing","layoutGrids","gridStyleId"];function s(e,t){return t?r(e,t,{include:l,exclude:["autoRename","characters","fontName","fontSize","rotation","primaryAxisSizingMode","counterAxisSizingMode","primaryAxisAlignItems","counterAxisAlignItems","constrainProportions","layoutAlign","layoutGrow","layoutMode"]}):r(e)}function d(t){return e(this,void 0,void 0,(function*(){var e=c();for(let i=0;i<e.length;i++){if(e[i].id===t.id)return console.log("Layer style already exists"),void figma.notify("Layer style already exists")}var i={id:t.id,node:s(t),name:t.name};e.push(i),figma.root.setPluginData("styles",JSON.stringify(e))}))}function g(e,t,i,n){var o=c();o.map(o=>{o.id==e&&(t&&(o.name=t),i&&(o.node=i),n&&(o.id=n))}),figma.root.setPluginData("styles",JSON.stringify(o))}function c(e){var t=figma.root.getPluginData("styles");if(t=""!==t?JSON.parse(t):[],e){var i=t.filter((function(t){return t.id===e}));t=i[0]}return t}function f(e,t){var i;if(e&&(i=e),t){i=[];var n=figma.root.children,o=n.length;for(let e=0;e<o;e++)n[e].findAll(e=>{e.getPluginData("styleId")===t&&i.push(e)})}for(let e=0;e<i.length;e++){var a,r=i[e],l=r.getPluginData("styleId"),d=figma.getNodeById(l);d?(g(l,null,s(a=d)),s(a,r)):(s(a=c(l).node,r),console.log("Original node can't be found"))}}function u(t){return e(this,void 0,void 0,(function*(){if(t.length>0)if(t.length<=20){(n=t.map(e=>e)).sort((e,t)=>e.x-t.x),t=n.sort((e,t)=>e.y-t.y);for(var e=0;e<t.length;e++){var i=t[e];i.setPluginData("styleId",i.id),d(i)}}else figma.notify("Limited to 20 layer styles at a time");else figma.notify("No layers selected");var n}))}function m(e){e.setPluginData("styleId",""),e.setRelaunchData({})}function y(){var e=c();figma.ui.postMessage(e)}var p=null;if(figma.on("selectionchange",()=>{!function(e){if(e&&1===e.length){var t=e[0];t.id===t.getPluginData("styleId")&&(console.log("Selection is main layer style"),p=t)}}(figma.currentPage.selection),console.log("Selection changed"),p&&setInterval(()=>{!function(e){e&&(g(e.getPluginData("styleId"),null,s(e)),y())}(p)},600),0===figma.currentPage.selection.length&&(p=null)}),"showStyles"===figma.command&&(figma.showUI(__html__,{width:240,height:360}),y(),figma.ui.onmessage=e=>{if("add-style"===e.type&&(u(figma.currentPage.selection),y()),"rename-style"===e.type&&(g(e.id,e.name),y()),"update-instances"===e.type&&(f(figma.currentPage.selection,e.id),y()),"update-style"===e.type){var t=s(i=figma.currentPage.selection[0]);g(e.id,null,t,i.id),figma.currentPage.selection[0].setPluginData("styleId",i.id),y()}if("edit-layer-style"===e.type){var i;if(function(e){return!e||(null===e.parent||null===e.parent.parent)}(i=figma.getNodeById(e.id))){var n=(i=figma.createFrame()).id;s((t=c(e.id)).node,i),function(e){e.x=figma.viewport.center.x-e.width/2,e.y=figma.viewport.center.y-e.height/2}(i),i.name=`${t.name}`,figma.viewport.scrollAndZoomIntoView([i]),figma.viewport.zoom=.25,i.setPluginData("styleId",i.id),g(e.id,null,null,i.id),(o=e.id,figma.root.findAll(e=>e.getPluginData("styleId")===o)).map(e=>{e.setPluginData("styleId",n)}),figma.currentPage.selection=[i]}else figma.viewport.scrollAndZoomIntoView([i]),figma.viewport.zoom=.25,figma.currentPage=function e(t){return"PAGE"===t.parent.type?t.parent:e(t.parent)}(i),figma.currentPage.selection=[i];y()}var o;"apply-style"===e.type&&function(e,t){var i;i=c(t).node;var n=figma.getNodeById(t);if(e.length<=100)if(e.length>0){for(let a=0;a<e.length;a++){var o=e[a];o.setPluginData("styleId",t),o.setRelaunchData({detachLayerStyle:"Removes association with layer style"}),n?s(i=n,o):(s(i,o),console.log("Original node can't be found"))}figma.notify("Layer style applied")}else figma.notify("Please select a layer");else figma.notify("Limited to 100 layers at a time")}(figma.currentPage.selection,e.id),"remove-style"===e.type&&(!function(e){var t=c();t.splice(t.findIndex(t=>t.id===e),1),figma.root.setPluginData("styles",JSON.stringify(t)),figma.root.findAll(t=>{t.getPluginData("styleId")===e&&t.setPluginData("styleId","")})}(e.id),y())}),"createStyles"===figma.command&&(u(figma.currentPage.selection),figma.closePlugin()),"updateStyles"===figma.command&&(f(figma.currentPage.selection),figma.closePlugin()),"clearLayerStyles"===figma.command&&(figma.root.setPluginData("styles",""),console.log("Styles cleared"),figma.closePlugin()),"copyProperties"===figma.command&&s(figma.currentPage.selection[0]),"detachLayerStyle"===figma.command){for(var h=0;h<figma.currentPage.selection.length;h++){m(figma.currentPage.selection[h])}figma.notify("Layer style detached"),figma.closePlugin()}
